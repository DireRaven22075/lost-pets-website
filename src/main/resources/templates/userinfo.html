<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User Information</title>
    <link rel="stylesheet" type="text/css" href="/src/css/userinfo.css" />
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <div class="header">
        <h1>User Information</h1>
        <div class="buttons">
          <button onclick="location.href='index.html'">메인 페이지</button>
          <button id="logoutButton">Logout</button>
        </div>
      </div>

      <!-- Left Section: Recent Posts -->
      <div class="recent-posts">
        <h2>최근 작성한 게시글</h2>
        <div id="recent-posts-list"></div>
      </div>
      <script src="js/test.js"></script>

      <!-- Left Section: Recent Posts
    <div class="reviews">
      <h1>최근 작성한 게시글</h1>
      <div class="review-box">
        <a href="#">게시글 1</a>
      </div>
      <div class="review-box">
        <a href="#">게시글 2</a>
      </div>
      <div class="review-box">
        <a href="#">게시글 3</a>
      </div>
    </div>
     -->

      <!-- Center Section: Profile Picture -->
      <div class="profile">
        <img id="profile-pic" src="default-profile.png" alt="Profile Picture" />
        <label>
          <input
            type="file"
            id="upload-image"
            style="display: none"
            accept="image/*"
          />
          <button onclick="document.getElementById('upload-image').click()">
            이미지 변경
          </button>
        </label>
      </div>

      <!-- Right Section: User Info -->
      <div class="user-info">
        <div class="info">
          <div><strong>Name:</strong> <span id="user-name">user</span></div>
          <div>
            <strong>Address:</strong> <span id="user-address">청주</span>
          </div>
          <div>
            <strong>Email address:</strong>
            <span id="user-email">user@mail.com</span>
          </div>
          <div><strong>ID:</strong> <span id="user-id">petlover</span></div>
          <div>
            <strong>PW:</strong>
            <span id="user-pw-length">******** (8 characters)</span>
          </div>
        </div>

        <div class="update">
          <input type="text" id="new-id" placeholder="New ID" />
          <input type="password" id="new-password" placeholder="New Password" />
          <input type="email" id="new-email" placeholder="New Email" />
          <input type="text" id="new-address" placeholder="New Address" />
          <button id="update-btn">Update</button>
        </div>
      </div>
    </div>

    <script>
      // 이미지 변경 처리
      document
        .getElementById("upload-image")
        .addEventListener("change", function (event) {
          const file = event.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
              document.getElementById("profile-pic").src = e.target.result;
            };
            reader.readAsDataURL(file);
          }
        });

      // 사용자 정보 업데이트 처리
      document.getElementById("update-btn").addEventListener("click", () => {
        const newId = document.getElementById("new-id").value;
        const newPassword = document.getElementById("new-password").value;
        const newEmail = document.getElementById("new-email").value;
        const newAddress = document.getElementById("new-address").value;

        // 정보 업데이트
        if (newId) {
          document.getElementById("user-id").textContent = newId;
        }
        if (newPassword) {
          const passwordLength = newPassword.length;
          const maskedPassword = "*".repeat(passwordLength); // 비밀번호를 *로 표시
          document.getElementById(
            "user-pw-length"
          ).textContent = `${maskedPassword} (${passwordLength} characters)`;
        }
        if (newEmail) {
          document.getElementById("user-email").textContent = newEmail;
        }
        if (newAddress) {
          document.getElementById("user-address").textContent = newAddress;
        }

        // 알림 표시
        alert(
          `업데이트 내역입니다:\nID: ${newId || "Not Changed"}\nPassword: ${
            newPassword ? "Updated" : "Not Changed"
          }\nEmail: ${newEmail || "Not Changed"}\nAddress: ${
            newAddress || "Not Changed"
          }`
        );

        // 입력 필드 초기화
        document.getElementById("new-id").value = "";
        document.getElementById("new-password").value = "";
        document.getElementByById("new-email").value = "";
        document.getElementById("new-address").value = "";
      });

      // 로그아웃 처리
      // 로그아웃 버튼 클릭 시
      document
        .getElementById("logoutButton")
        .addEventListener("click", function () {
          // 로그아웃 처리 후 localStorage에서 로그인 상태를 0으로 설정
          localStorage.setItem("logInFlag", 0); // 로그아웃 상태로 설정
          alert("로그아웃 되었습니다.");
          window.location.href = "index.html"; // 로그아웃 후 index.html로 리디렉션
        });

      document.addEventListener("DOMContentLoaded", function () {
        // 로그아웃 버튼을 클릭하면 localStorage의 로그인 상태를 변경하고 페이지 이동
        const logoutButton = document.getElementById("logoutButton");

        if (logoutButton) {
          logoutButton.addEventListener("click", function () {
            // 로그아웃 상태로 localStorage 업데이트
            localStorage.setItem("logInFlag", 0); // 로그아웃 상태로 설정
            alert("로그아웃 되었습니다.");
            window.location.href = "index.html"; // index.html로 리디렉션
          });
        }

        // 로그인 상태를 확인하여 버튼 링크를 변경하는 부분
        let logInFlag = localStorage.getItem("logInFlag");

        const getStartedButton = document.getElementById("getStartedButton");

        if (logInFlag == 1) {
          alert("로그인 상태입니다. 사용자 정보 페이지로 이동합니다.");
          getStartedButton.href = "userinfo.html"; // 로그인 상태일 때 유저 정보 페이지로 연결
        } else if (logInFlag == 0 || logInFlag === null) {
          alert("로그아웃 상태입니다. 로그인 페이지로 이동합니다.");
          getStartedButton.href = "login.html"; // 비로그인 상태일 때 로그인 페이지로 연결
        }
      });
    </script>
  </body>
</html>
